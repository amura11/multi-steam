<UserControl
    x:Class="PlayniteMultiAccountSteamLibrary.Extension.SteamLibrarySettingsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:PlayniteMultiAccountSteamLibrary.Extension"
    xmlns:infra="clr-namespace:PlayniteMultiAccountSteamLibrary.Extension.Infrastructure"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance Type=local:SteamLibrarySettingsViewModel, IsDesignTimeCreatable=True}"
    d:DesignHeight="600"
    d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <Style x:Key="HeaderTextBlock" TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
                <Setter Property="FontSize" Value="{DynamicResource FontSizeLarger}" />
                <Setter Property="FontWeight" Value="Bold" />
                <Setter Property="Margin" Value="0,0,0,10" />
            </Style>

            <Thickness x:Key="ControlBottomMargin">0,0,0,5</Thickness>
            <Thickness x:Key="ControlMargin">5,5,5,5</Thickness>

            <infra:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <infra:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter" />
            <infra:ResourceKeyConverter x:Key="ResourceKeyConverter" />
            <infra:StringNullOrEmptyToVisibilityConverter x:Key="StringNullOrEmptyToVisibilityConverter" />
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="{DynamicResource WindowBackgourndBrush}">
        <StackPanel>
            <StackPanel Margin="20">
                <TextBlock Text="{DynamicResource HeaderSwitcherToolSettings}" Style="{DynamicResource HeaderTextBlock}" />

                <ComboBox ItemsSource="{infra:EnumValues {x:Type local:SwitcherToolInstallationType}}"
                          SelectedItem="{Binding Settings.SwitcherToolInstallationType}"
                          Margin="{StaticResource ControlBottomMargin}" />

                <!-- Manual Mode -->
                <StackPanel Orientation="Horizontal"
                            Visibility="{Binding Settings.SwitcherToolInstallationType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Manual}"
                            VerticalAlignment="Center"
                            Margin="0,0,0,10">
                    <TextBox Text="{Binding Settings.LauncherLocation}" MinWidth="220" IsReadOnly="True" Margin="0,0,8,0" VerticalAlignment="Center" />
                    <Button Content="Browse..." Command="{Binding BrowseForSwitcherToolCommand}" MinWidth="90" VerticalAlignment="Center" />
                </StackPanel>

                <!-- Automatic Mode -->
                <Border Visibility="{Binding Settings.SwitcherToolInstallationType, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=Automatic}"
                        Padding="10" Margin="0,0,0,10" Background="{DynamicResource GridItemBackgroundBrush}" CornerRadius="4">
                    <StackPanel Orientation="Vertical">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Vertical" VerticalAlignment="Center" Grid.Column="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                    <TextBlock Text="{DynamicResource LabelSwitcherToolLocalVersion}" FontWeight="SemiBold" Margin="0,0,4,0" />
                                    <TextBlock Text="{Binding LocalSwitcherToolVersion}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                    <TextBlock Text="{DynamicResource LabelSwitcherToolRemoteVersion}" FontWeight="SemiBold" Margin="0,0,4,0" />
                                    <TextBlock Text="{Binding RemoteSwitcherToolVersion}" />
                                </StackPanel>
                            </StackPanel>
                            <Button Grid.Column="1"
                                    MinWidth="110"
                                    Height="32"
                                    Margin="16,0,0,0"
                                    VerticalAlignment="Center"
                                    Command="{Binding InstallSwitcherToolCommand}"
                                    IsEnabled="{Binding IsSwitcherToolInstallButtonEnabled}">
                                <TextBlock Text="{Binding SwitcherToolInstallButtonTextKey, Converter={StaticResource ResourceKeyConverter}}" />
                            </Button>
                        </Grid>
                        <TextBlock Text="{Binding InstallErrorMessage}" Foreground="{DynamicResource WarningBrush}" Margin="0,8,0,0" Visibility="{Binding InstallErrorMessage, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>
                </Border>
            </StackPanel>
            <StackPanel Margin="20">
                <TextBlock Text="Steam Accounts" Style="{DynamicResource HeaderTextBlock}" />

                <ItemsControl ItemsSource="{Binding Settings.SteamAccountSettings}"
                              Margin="{StaticResource ControlBottomMargin}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource GridItemBackgroundBrush}">
                                <Grid Margin="{StaticResource ControlMargin}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*" />
                                        <!-- Name + ID -->
                                        <ColumnDefinition Width="3*" />
                                        <!-- API Key -->
                                        <ColumnDefinition Width="Auto" />
                                        <!-- Buttons -->
                                    </Grid.ColumnDefinitions>

                                    <!-- Left: Name & ID -->
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="Bold" />
                                        <TextBlock Text="{Binding Id}"
                                                   FontSize="{DynamicResource FontSizeSmall}"
                                                   Foreground="{DynamicResource TextBrushDarker}" />
                                    </StackPanel>

                                    <!-- Middle: API Key -->
                                    <TextBlock
                                        Grid.Column="1"
                                        Text="{Binding Key}"
                                        VerticalAlignment="Center"
                                        TextTrimming="CharacterEllipsis"
                                        Margin="10,0"
                                        FontFamily="Consolas" />

                                    <!-- Right: Buttons -->
                                    <StackPanel
                                        Grid.Column="2"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Right"
                                        Margin="10,0,0,0">
                                        <Button
                                            Content="Edit"
                                            Width="60"
                                            Margin="0,0,8,0"
                                            Command="{Binding DataContext.EditSteamAccountCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}" />

                                        <Button
                                            Content="Delete"
                                            Width="60"
                                            Command="{Binding DataContext.DeleteAccountCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Button Content="Add Account"
                        Command="{Binding AddSteamAccountCommand}" />
            </StackPanel>
        </StackPanel>

        <Grid Background="#AA000000"
              d:IsHidden="True"
              Visibility="{Binding IsAccountEditorVisible, Converter={StaticResource BoolToVisibilityConverter}}"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">

            <Border
                BorderThickness="{DynamicResource PopupBorderThickness}"
                BorderBrush="{DynamicResource PopupBorderBrush}"
                Background="{DynamicResource PopupBackgroundBrush}"
                Width="400"
                Padding="20"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="Edit Account"
                               Style="{DynamicResource HeaderTextBlock}" />

                    <TextBlock Text="Account Name" />
                    <TextBox Text="{Binding EditingAccount.Name}"
                             Margin="0,0,0,5" />
                    <TextBlock Text="Steam ID" />
                    <TextBox
                        Text="{Binding EditingAccount.Id}"
                        Margin="0,0,0,5" />
                    <TextBlock Text="Steam API Key" />
                    <TextBox
                        Text="{Binding EditingAccount.Key}"
                        Margin="0,0,0,10" />

                    <TextBlock Text="{Binding AccountValidationErrorMessage}"
                               Foreground="{DynamicResource WarningBrush}"
                               Margin="0,0,0,10"
                               Visibility="{Binding AccountValidationErrorMessage, Converter={StaticResource StringNullOrEmptyToVisibilityConverter}}" />
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,10">
                        <ProgressBar Width="100" Height="8" IsIndeterminate="True" Visibility="{Binding IsTestingAccountCredentials, Converter={StaticResource BoolToVisibilityConverter}}" Margin="0,0,8,0" />
                        <TextBlock Text="Testing credentials..." VerticalAlignment="Center" Visibility="{Binding IsTestingAccountCredentials, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>

                    <StackPanel
                        Orientation="Horizontal"
                        HorizontalAlignment="Right">
                        <Button
                            Content="Cancel"
                            Margin="0,0,10,0"
                            Width="80"
                            Command="{Binding CancelEditSteamAccountCommand}" />
                        <Button
                            Content="Save"
                            Width="80"
                            Command="{Binding CompleteEditSteamAccountCommand}" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>